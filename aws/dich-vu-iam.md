# AWS IAM (Identity and Access Management) basics

üöÄ Authors: [@thanhnb](https://github.com/nbthanh98)

![aws-iam](../.gitbook/assets/IAM-AWS.png)

## 1. Gi·ªõi thi·ªáu chung

·ªû b√†i n√†y ch√∫ng ta c√πng nhau t√¨m hi·ªÉu d·ªãch v·ª• IAM. D·ªãch v·ª• IAM l√† d·ªãch v·ª• quan tr·ªçng gi√∫p x√°c th·ª±c v√† qu·∫£n l√Ω quy·ªÅn truy c·∫≠p v√†o c√°c t√†i nguy√™n tr√™n AWS. B√†i n√†y s·∫Ω ƒëi qua nh·ªØng ph·∫ßn sau:

- Gi·ªõi thi·ªáu v·ªÅ d·ªãch v·ª• IAM (AWS Identity and Access Management).
- T√¨m hi·ªÉu v·ªÅ IAM Identity (IAM User, IAM Group, IAM Role).
- T√¨m hi·ªÅu c·∫•u tr√∫c v√† c√°ch t·∫°o IAM Policy.
- Hands-on.

## 2. Gi·ªõi thi·ªáu AWS Identity and Access Management (IAM)

![aws-iam-overview](../.gitbook/assets/IAM-Identities-and-permission.png)

### 2.1. IAM l√† g√¨?

AWS Identity and Access Management (IAM) gi√∫p b·∫°n qu·∫£n l√Ω vi·ªác x√°c th·ª±c v√† quy·ªÅn truy c·∫≠p v√†o c√°c t√†i nguy√™n tr√™n AWS. S·ª≠ d·ª•ng IAM b·∫°n c√≥ th·ªÉ t·∫°o v√† qu·∫£n l√Ω c√°c users, group users v√† c√≥ th·ªÉ th√™m c√°c quy·ªÅn ƒë·ªÉ cho ph√©p ho·∫∑c kh√¥ng cho ph√©p truy c·∫≠p ƒë·∫øn t√†i nguy√™n n√†o ƒë√≥ tr√™n AWS. B·∫°n c√≥ th·ªÉ tham kh·∫£o th√™m t√†i li·ªáu ch√≠nh th·ª©c c·ªßa AWS [t·∫°i ƒë√¢y](https://aws.amazon.com/vi/iam/).

### 2.2. T·∫°i sao l·∫°i c·∫ßn ƒë·∫øn d·ªãch v·ª• IAM?

![why-we-need-iam-service](../.gitbook/assets/iam-2.png)

Khi t·∫°o m·ªôt t√†i kho·∫£n AWS th√¨ t√†i kho·∫£n ƒë√≥ g·ªçi l√† t√†i kho·∫£n root. T√†i kho·∫£n n√†y th√¨ kh√¥ng b·ªã gi·ªõi h·∫°n quy·ªÅn truy c·∫≠p ƒë·∫øn t√†i nguy√™n tr√™n AWS, AWS khuy√™n kh√¥ng n√™n s·ª≠ d·ª•ng t√†i kho·∫£n root cho vi·ªác x·ª≠ l√Ω c√°c t√°c v·ª• h√†ng n√†y. V√≠ d·ª• c√¥ng ty b·∫°n c√≥ nhi·ªÅu ph√≤ng ban, ·ª©ng d·ª•ng mu·ªën t∆∞∆°ng t√°c v·ªõi t√†i nguy√™n tr√™n AWS th√¨ kh√¥ng th·ªÉ c·∫•p cho h·ªç t√†i kho·∫£n root ƒë∆∞·ª£c m√† ph·∫£i t·∫°o c√°c IAM User v√† g√°n cho h·ªç nh·ªØng quy·ªÅn nh·∫•t ƒë·ªãnh, ƒë·ªÉ ki·ªÉm so√°t vi·ªác truy c·∫≠p c·ªßa h·ªç ƒë·∫øn c√°c t√†i nguy√™n tr√™n AWS.

### 2.3. M·ªôt s·ªë th√†nh ph·∫ßn trong IAM

![identity-objects-type](../.gitbook/assets/iam-4.png)

AWS IAM cho ph√©p t·∫°o 3 lo·∫°i Identity objects nh∆∞ h√¨nh tr√™n ƒë√≥ l√†:

- `IAM User`: ƒê·∫°i di·ªán cho ng∆∞·ªùi ho·∫∑c ·ª©ng d·ª•ng n√†o ƒë√≥ c·∫ßn truy c·∫≠p ƒë·∫øn t√†i kho·∫£n AWS. VD: Th√†nh c·∫ßn truy c·∫≠p ƒë·∫øn h√≥a ƒë∆°n c·ªßa t√†i kho·∫£n AWS v√† D≈©ng th√¨ c·∫ßn truy c·∫≠p ƒë·∫øn c√°c d·ªãch v·ª• c·ªßa AWS nh∆∞ EC2, D≈©ng c·∫ßn t·∫°o v√† t·∫Øt c√°c EC2 instances. Th√¨ l√∫c n√†y Th√†nh v√† D≈©ng c·∫ßn ph·∫£i t·∫°o c√°c IAM User b√™n trong d·ªãch v·ª• IAM. IAM User n√†y c≈©ng c√≥ th·ªÉ s·ª≠ d·ª•ng cho c√°c ·ª©ng d·ª•ng.

- `IAM Group`: L√† m·ªôt nh√≥m c√°c IAM User. VD c√≥ th·ªÉ t·∫°o ra m·ªôt nh√≥m Develop v√† g√°n quy·ªÅn cho nh√≥m n√†y, th√¨ c√°c IAM User khi ƒë∆∞·ª£c th√™m v√†o nh√≥m Develop c≈©ng c√≥ quy·ªÅn c·ªßa nh√≥m lu√¥n, kh√¥ng ph·∫£i ƒëi g√°n quy·ªÅn cho t·ª´ng IAM User.

- `IAM Role`: Th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ g√°n quy·ªÅn truy c·∫≠p ƒë·∫øn c√°c d·ªãch v·ª• tr√™n AWS. VD n·∫øu b·∫°n mu·ªën t·∫•t c·∫£ EC2 instance ƒë·ªÅu c√≥ th·ªÉ truy c·∫≠p ƒë·∫øn S3, b·∫°n s·∫Ω t·∫°o m·ªôt role v·ªõi quy·ªÅn truy c·∫≠p ƒë·∫øn S3 v√† sau ƒë√≥ s·∫Ω cho EC2 instance s·ª≠ d·ª•ng role n√†y. (c√°i n√†y h∆°i kh√≥ hi·ªÉu, s·∫Ω c√≥ demo ·ªü ph·∫ßn sau).

- `IAM Policy`: L√† t·∫≠p h·ª£p c√°c rule ƒë·ªÉ ƒë·ªãnh nghƒ©a vi·ªác cho ph√©p (Allow) ho·∫∑c kh√¥ng cho ph√©p (Deny) truy c·∫≠p v√†o d·ªãch v·ª• tr√™n AWS.

## 3. IAM Identities (users, user groups and role)

![iam-user-group-role](../.gitbook/assets/iam-user-group-role.png)

M·ªôt IAM identity ƒë·∫°i di·ªán cho m·ªôt user, user groups v√† roles, v√† c√≥ th·ªÉ x√°c th·ª±c (authen), ph√¢n quy·ªÅn (author) c√°c h√†nh ƒë·ªông tr√™n AWS. IAM identity c√≥ th·ªÉ ƒë∆∞·ª£c g√°n v·ªõi m·ªôt ho·∫∑c nhi·ªÅu policy.

### 3.1 C√°ch t·∫°o IAM User

Step 1: V√†o [AWS Console](https://aws.amazon.com/console/) => Login t√†i kho·∫£n AWS.

Step 2: T√¨m ki·∫øm d·ªãch v·ª• IAM ·ªü √¥ search.

![tao-iam-user](../.gitbook/assets/tao-iam-user.png)

Step 3: Click v√†o "User" => Click "Add users".

![tao-iam-user](../.gitbook/assets/tao-iam-user-3.png)

Step 4: ƒêi·ªÅn c√°c th√¥ng tin c·ªßa IAM user.

![tao-iam-user](../.gitbook/assets/tao-iam-user-5.png)

Gi·∫£i th√≠ch:
- (1): Th√¥ng tin user name, d√πng ƒë·ªÉ ƒëƒÉng nh·∫≠p.
- (2): T√≠ch ch·ªçn th√¨ s·∫Ω gen ra "Access key ID" v√† "secret access key", c√≥ th·ªÉ d√πng ƒë·ªÉ access AWS th√¥ng qua CLI, SDK, ...
- (3): T√≠ch ch·ªçn th√¨ s·∫Ω sinh ra √¥ "console password", d√πng ƒë·ªÉ c√≥ th·ªÉ ƒëƒÉng nh·∫≠p qua [AWS Console](https://aws.amazon.com/console/).
- (4): ·ªû ph·∫ßn "console password" c√≥ th·ªÉ l·ª±a ch·ªçn "Autogenerated password" (AWS t·ª± gen) ho·∫∑c "Custom password" (t·ª± nh·∫≠p).
- (5): ·ªû ph·∫ßn "Require password reset" th√¨ khi t√≠ch ch·ªçn sau khi user ƒë∆∞·ª£c t·∫°o l·∫ßn ƒë·∫ßu ti√™n ƒëƒÉng nh·∫≠p s·∫Ω ph·∫£i ƒë·ªïi password.
- Ch·ªçn "Next: Permissions" ƒë·ªÉ chuy·ªÉn sang ph·∫ßn ph√¢n quy·ªÅn cho IAM user.

Step 5: Ph·∫ßn n√†y th√¨ s·∫Ω ph√¢n quy·ªÅn cho IAM user b·∫±ng c√°ch: th√™m IAM user v√†o user groups, copy quy·ªÅn t·ª´ c√°c IAM user hi·ªán c√≥ ho·∫∑c l√† g√°n c√°c policies. Ph·∫ßn n√†y t·∫°m th·ªùi m√¨nh s·∫Ω kh√¥ng th√™m quy·ªÅn g√¨ cho IAM user n√†y c·∫£, v√¢y khi t·∫°o IAM user n√†y th√¨ user s·∫Ω kh√¥ng c√≥ quy·ªÅn.

![tao-iam-user](../.gitbook/assets/tao-iam-user-6.png)

Step 6, 7, 8: Th√™m tag cho IAM User => Review l·∫°i IAM User mu·ªën t·∫°o => Th·ª±c hi·ªán t·∫°o IAM User.

### 3.2 C√°ch t·∫°o IAM User groups

Step 1: V√†o [AWS Console](https://aws.amazon.com/console/) => Login t√†i kho·∫£n AWS.

Step 2: T√¨m ki·∫øm d·ªãch v·ª• IAM ·ªü √¥ search.

![tao-iam-user-group](../.gitbook/assets/tao-iam-user.png)

Step 3: Click v√†o "User groups" => "Create user group".

![tao-iam-user-group](../.gitbook/assets/tao-iam-user-group.png)

Gi·∫£i th√≠ch:
- ƒêi·ªÅn th√¥ng tin t√™n user group.
- (Optional) C√≥ th·ªÉ th√™m lu√¥n c√°c IAM user v√†o user group.
- (Optional) C√≥ th·ªÉ g√°n lu√¥n c√°c policies cho user group.

Step 4: Click "Create group".

### 3.3 Th√™m IAM User v√†o IAM User group

Step 1: V√†o [AWS Console](https://aws.amazon.com/console/) => Login t√†i kho·∫£n AWS.

Step 2: T√¨m ki·∫øm d·ªãch v·ª• IAM ·ªü √¥ search.

![tao-iam-user-group](../.gitbook/assets/tao-iam-user.png)

Step 3: Click v√†o "User groups" => Click v√†o user group "test-iam-user-group" (m·ªõi t·∫°o ·ªü ph·∫ßn 3.2).

![add-iam-user-to-user-group](../.gitbook/assets/add-iam-user-to-user-group.png)

Step 4: Click "Add users".

![add-iam-user-to-user-group](../.gitbook/assets/add-iam-user-to-user-group-2.png)


Step 5: Chon c√°c IAM user mu·ªën th√™m v√†o group. ·ªû ƒë√¢y m√¨nh ch·ªçn IAM user "test-iam" (ƒë√£ t·∫°o ·ªü ph·∫ßn 3.1).

![add-iam-user-to-user-group](../.gitbook/assets/add-iam-user-to-user-group-3.png)

## 4. C√°c th√†nh ph·∫ßn c·ªßa IAM Identity Policy (IAM Policy)

IAM Policies s·∫Ω ƒë∆∞·ª£c g√°n v·ªõi c√°c Identity(IAM User, IAM Group, IAM Role). IAM Policy g·ªìm c√°c rule ƒë·ªÉ m√¥ t·∫£ vi·ªác cho ph√©p (allow) ho·∫∑c kh√¥ng cho ph√©p (deny) truy c·∫≠p ƒë·∫øn c√°c d·ªãch v·ª• tr√™n AWS. IAM Policy ƒë∆∞·ª£c vi·∫øt b·∫±ng Json. C√≥ 2 lo·∫°i policies ƒë√≥ l√†:

- `Identity-based policies`: Identity-based policies ƒë∆∞·ª£c g·∫Øn v·ªõi AWS Identities gi·ªëng nh∆∞ (user, group ho·∫∑c role). VD gi·ªù c√≥ 1 IAM User l√† `ThanhNB` ch·∫≥ng h·∫°n, mu·ªën xem ƒë∆∞·ª£c c√°c item trong S3 bucket l√† `example-s3-bucket`. Identity-based policies chia th√™m th√†nh c√°c lo·∫°i sau:

  - `Managed policies`: Nh·ªØng policies n√†y c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng l·∫°i v√† c√≥ th·ªÉ g·∫Øn v·ªõi nhi·ªÅu entity. AWS m·∫∑c ƒë·ªãnh ƒë√£ t·∫°o ra nh·ªØng `managed policies`, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng n√≥ lu√¥n ho·∫∑c t·ª± t·∫°o c√°c `managed policies` cho m√¨nh.

    - `AWS Managed`: Nh·ªØng policies n√†y ƒë∆∞·ª£c t·∫°o, update v√† qu·∫£n l√Ω b·ªüi AWS. M·∫∑c ƒë·ªãnh th√¨ c√°c policies do AWS managed ƒë√£ ƒë∆∞·ª£c t·∫°o tr∆∞·ªõc v√† c√≥ s·∫µn trong t√†i kho·∫£n AWS c·ªßa b·∫°n. 

    - `Customer Managed`: Nh·ªØng policies n√†y do ng∆∞·ªùi d√πng t·ª± t·∫°o, t·ª± qu·∫£n l√Ω.

  - `Inline policies`: Nh·ªØng policies n√†y ƒë∆∞·ª£c g·∫Øn tr·ª±c ti·∫øp v√†o IAM entity. Nh∆∞ng c√°c policies n√†y th√¨ KH√îNG t√°i s·ª≠ d·ª•ng ƒë∆∞·ª£c v√† KH√îNG th·ªÉ g·∫Øn cho nhi·ªÅu IAM entity.

- `Resource-based policies`: Resource-based policies l√† nh·ªØng policies ƒë∆∞·ª£c g·∫Øn v√†o AWS resources gi·ªëng nh∆∞ S3, SQS,...

### 4.1 Identity-based policies

Identity-based policies l√† g√¨?

Identity-base policies ƒë·ªãnh nghƒ©a m·ªôt Identity(users, roles) c√≥ th·ªÉ l√†m g√¨? gi·ªëng nh∆∞ l√† c√≥ th·ªÉ access ƒë·∫øn m·ªôt S3 Bucket hay kh√¥ng. Vi·ªác b·∫°n g√°n c√°c policies cho Identity gi·ªëng nh∆∞ b·∫°n c√°c c·∫•p quy·ªÅn cho Identity truy c·∫≠p ƒë·∫øn c√°c AWS resource. B·∫°n c√≥ th·ªÉ tham kh·∫£o th√™m [·ªü ƒë√¢y](https://github.com/awsdocs/aws-glue-developer-guide/blob/master/doc_source/using-identity-based-policies.md).

C√°ch define Identity-based policies?

```json
{
    // "Version" l√† version c·ªßa policies language(2012-10-17).
	"Version": "2012-10-17",
    // "Statement": l√† m·ªôt m·∫£ng c√°c statment policy.
	"Statement": [
		{
            // "Sid": tr∆∞·ªùng n√†y optional, d√πng ƒë·ªÉ ph√¢n bi·ªát gi·ªØa c√°c stament b√™n trong m·∫£ng "Statement"
            "Sid": "AllowS3GetObject",

            // "Effect": m√¥ t·∫£ vi·ªác cho ph√©p (Allow) ho·∫∑c KH√îNG cho ph√©p (Deny).
            "Effect": "Allow",

            // "Action": m√¥ t·∫£ danh s√°ch c√°ch h√†nh ƒë·ªông m√† policy cho ph√©p (Allow) ho·∫∑c KH√îNG cho ph√©p (Deny).
			"Action": [
				"s3:GetObject"
			],

            // "Resource": m√¥ t·∫£ c√°c resource m√† policy mu·ªën t∆∞∆°ng t√°c.
			"Resource": [
                "arn:aws:s3:::<bucket_name>/**"
            ]
		}
	]
}
```

Hands-on t·∫°o Identity-base policies


### 4.2 Resource-based policies

## 5. T·ªïng k·∫øt